registrationModule.controller("ordenController",function(e,a,r,t,n,o,s,u){function l(e){scope.$apply(function(){e.lengthComputable?scope.progress=Math.round(100*e.loaded/e.total):scope.progress="unable to compute"})}function c(e){alert(e.target.responseText)}function i(e){alert("There was an error attempting to upload the file.")}function d(e){scope.$apply(function(){scope.progressVisible=!1}),alert("The upload has been canceled by the user or the browser dropped the connection.")}e.proveedorId=r.idProveedor,e.viewbyV=5,e.totalItemsV,e.currentPageV=4,e.itemsPerPageV=e.viewbyV,e.maxSizeV=5,e.totalValidadas,e["var"]=1,e.viewbyPP=5,e.totalItemsPP,e.currentPagePP=4,e.itemsPerPagePP=e.viewbyPP,e.maxSizePP=5,e.totalProgPago,e.viewbyP=5,e.totalItemsP,e.currentPageP=4,e.itemsPerPageP=e.viewbyP,e.maxSizeP=5,e.totalPagadas,e.OpcionDefaultEmpresa="---Elije una opción---",e.OpcionDefaultSucursal="---Elije una opción---",e.currentEmpresa,e.currentSucursal,e.OpcionDefaultEmpresaV="---Elije una opción---",e.OpcionDefaultSucursalV="---Elije una opción---",e.currentEmpresaV,e.currentSucursalV,e.OpcionDefaultEmpresaPP="---Elije una opción---",e.OpcionDefaultSucursalPP="---Elije una opción---",e.currentEmpresaPP,e.currentSucursalPP,e.OpcionDefaultEmpresaP="---Elije una opción---",e.OpcionDefaultSucursalP="---Elije una opción---",e.currentEmpresaP,e.currentSucursalP,e.valEmpresa=null,e.valSucursal=null,e.currentTextPendiente=null,e.valEmpresaV=null,e.valSucursalV=null,e.valEmpresaPP=null,e.valSucursalPP=null,e.valEmpresaP=null,e.valSucursalP=null,e.rutaDocumento=null,r.validaEstatus=null,e.init=function(){return""==r.idProveedor||null==r.idProveedor||void 0==r.idProveedor?void n.warning("Por favor inicie sesión ."):(r.idProveedorMenu=!1,void p())};var p=function(){o.getOrdenPendiente(e.proveedorId).then(function a(t){r.PendientesUno=t.data,e.listaPendiente=t.data,e.totalItems=t.data.length,e.totalPendientes=t.data.length,$("#tablaPendientes").tablesorter()},function t(e){n.error("Ocurrio un problema")}),o.getOrdenValidadas(e.proveedorId).success(m).error(v),o.getOrdenPagadas(e.proveedorId).success(g).error(v),o.getEmpresa(e.proveedorId).success(f).error(v)},P=function(a,t,o,s){r.PendientesUno=a,e.listaPendiente=a,e.totalItems=a.length,e.totalPendientes=a.length,n.success("Datos Obtenidos.")},m=function(a,r,t,o){e.listaValidadas=a,e.totalItemsV=a.length,e.totalValidadas=a.length,n.success("Datos Obtenidos.")},g=function(a,r,t,o){e.listaPagadas=a,e.totalItemsP=a.length,e.totalPagadas=a.length,n.success("Datos Obtenidos.")},f=function(a,r,t,o){e.listaEmpresas=a,e.listaEmpresasV=a,e.listaEmpresasPP=a,e.listaEmpresasP=a,n.success("Datos de Empresas cargados.")},v=function(e,a,r,t){p(),n.error("Ocurrio un problema: "+e)};e.getSucursal=function(a){e.OpcionDefaultEmpresa=null,e.currentEmpresa=a,e.valEmpresa=a.emp_idempresa,o.getSucursales(a.emp_idempresa).success(h).error(v);var r=e.proveedorId,t=null,n=e.valEmpresa;("0"==n||"0"==n)&&(n=null);var u=null;("0"==u||"0"==u)&&(u=null),s.getOrdenPendiente(r,t,n,u).success(P).error(v)};var h=function(a,r,t,o){e.listaSucursales=a,n.success("Datos de Sucursales cargados.")};e.setSucursal=function(a){e.OpcionDefaultSucursal=null,e.currentSucursal=a,e.valSucursal=a.suc_idsucursal;var r=e.proveedorId,t=null,n=e.valEmpresa;("0"==n||"0"==n)&&(n=null);var o=e.valSucursal;("0"==o||"0"==o)&&(o=null),s.getOrdenPendiente(r,t,n,o).success(P).error(v)},e.getSucursalV=function(a){e.OpcionDefaultEmpresaV=null,e.currentEmpresaV=a,e.valEmpresa=a.emp_idempresa,o.getSucursales(a.emp_idempresa).success(S).error(v);var r=e.proveedorId,t=null,n=a.emp_idempresa;("0"==n||"0"==n)&&(n=null);var u=null;("0"==u||"0"==u)&&(u=null),s.getOrdenValidadas(r,t,n,u).success(m).error(v)};var S=function(a,r,t,o){e.listaSucursalesV=a,n.success("Datos de Sucursales cargados.")};e.setSucursalV=function(a){e.OpcionDefaultSucursalV=null,e.currentSucursalV=a,e.valSucursalV=a.suc_idsucursal;var r=e.proveedorId,t=null,n=a.emp_idempresa;("0"==n||"0"==n)&&(n=null);var o=a.suc_idsucursal;("0"==o||"0"==o)&&(o=null),s.getOrdenValidadas(r,t,n,o).success(m).error(v)},e.getSucursalPP=function(a){e.OpcionDefaultEmpresaPP=null,e.currentEmpresaPP=a,e.valEmpresa=a.emp_idempresa,o.getSucursales(a.emp_idempresa).success(D).error(v);var r=e.proveedorId,t=null,n=a.emp_idempresa;("0"==n||"0"==n)&&(n=null);var u=null;("0"==u||"0"==u)&&(u=null),s.getOrdenProgPago(r,t,n,u).success(getProgPagoSuccessCallback).error(v)};var D=function(a,r,t,o){e.listaSucursalesPP=a,n.success("Datos de Sucursales cargados.")};e.setSucursalPP=function(a){e.OpcionDefaultSucursalPP=null,e.currentSucursalPP=a,e.valSucursalPP=a.suc_idsucursal;var r=e.proveedorId,t=null,n=a.emp_idempresa;("0"==n||"0"==n)&&(n=null);var o=a.suc_idsucursal;("0"==o||"0"==o)&&(o=null),s.getOrdenProgPago(r,t,n,o).success(getProgPagoSuccessCallback).error(v)},e.getSucursalP=function(a){e.OpcionDefaultEmpresaP=null,e.currentEmpresaP=a,e.valEmpresaP=a.emp_idempresa,o.getSucursales(a.emp_idempresa).success(b).error(v);var r=e.proveedorId,t=null,n=a.emp_idempresa;("0"==n||"0"==n)&&(n=null);var u=null;("0"==u||"0"==u)&&(u=null),s.getOrdenPagadas(r,t,n,u).success(g).error(v)};var b=function(a,r,t,o){e.listaSucursalesP=a,n.success("Datos de Sucursales cargados.")};e.setSucursalP=function(a){e.OpcionDefaultSucursalP=null,e.currentSucursalP=a,e.valSucursalP=a.suc_idsucursal;var r=e.proveedorId,t=null,n=a.emp_idempresa;("0"==n||"0"==n)&&(n=null);var o=a.suc_idsucursal;("0"==o||"0"==o)&&(o=null),s.getOrdenPagadas(r,t,n,o).success(g).error(v)},e.setPageV=function(a){e.currentPageV=a},e.pageChangedV=function(){console.log("Page changed to: "+e.currentPageV)},e.setItemsPerPageV=function(a){e.itemsPerPageV=a,e.currentPageV=1},e.setPagePP=function(a){e.currentPagePP=a},e.pageChangedPP=function(){console.log("Page changed to: "+e.currentPagePP)},e.setItemsPerPagePP=function(a){e.itemsPerPagePP=a,e.currentPagePP=1},e.setPageP=function(a){e.currentPageP=a},e.pageChangedP=function(){console.log("Page changed to: "+e.currentPageP)},e.setItemsPerPageP=function(a){e.itemsPerPageP=a,e.currentPageP=1},e.buscaPagadas=function(){var a=e.proveedorId,r=document.getElementById("inputPagadas").value,t=e.valEmpresaP;("0"==t||"0"==t)&&(t=null);var n=e.valSucursalP;("0"==n||"0"==n)&&(n=null),s.getOrdenPagadas(a,r,t,n).success(g).error(v)},e.verFactura=function(a){e.rutaDocumento=a.oce_folioorden,o.getDocumentos(a.oce_folioorden).then(function r(t){var o="";if(o="application/pdf",e.rutaDocumento=t.data,"0"==t.data)return void n.warning("No hay ningun documento para mostrar");var s="http://192.168.20.9/GA_Centralizacion/CuentasXPagar/TempPdf/OrdenCompra/Orden_"+a.oce_folioorden+".pdf",u=s,l="Factura",c='<div id="hideFullContent" style="width:500px; height:600px;"><div id="hideFullMenu" onclick="nodisponible()" ng-controller="ordenController"> </div> <object id="ifDocument" data="'+u+'" type="'+o+'" width="100%" height="100%"></object></div>';$.createModal({title:l,message:c,closeButton:!1,scrollable:!1})},function t(e){n.error("Ocurrio un problema al validar estatus : "+e.data)})},e.verFactura2=function(a){e.rutaDocumento=a.oce_folioorden,o.getDocumentos(a.oce_folioorden).then(function t(n){e.rutaDocumento=n.data;var o,s="";s="application/pdf";var u="http://192.168.20.9:3700",l=u,c="Subir Documentos",i=r.user,d=r.pass,p=a.oce_folioorden,P="0";o="0"==n.data?"http://192.168.20.9/GA_Centralizacion/CuentasXPagar/TempPdf/OrdenCompra/Orden_AU-AUA-VIG-UN-PS-26.pdf":"http://192.168.20.9/GA_Centralizacion/CuentasXPagar/TempPdf/OrdenCompra/Orden_"+a.oce_folioorden+".pdf";var m='<iframe frameborder="1" height="600px" width="550px" src="http://192.168.20.9:8085/Login.aspx?user='+i+"&pass="+d+"&folio="+p+"&editar="+P+"&rutaPDF="+o+'" width="100%">Tu Navegador no soporta esta característica</iframe>';$.createModal({title:c,message:m,closeButton:!1,scrollable:!1})},function s(e){n.error("Ocurrio un problema al generar la factura")})},e.verFacturaValidada=function(a){s.getBuscaEstatus(a.oce_folioorden).then(function t(s){return r.validaEstatus=s.data,"2"==r.validaEstatus[0].estatus?void n.warning("la factura ya fue procesada, no es posible actualizar."):(e.rutaDocumento=a.oce_folioorden,void o.getDocumentos(a.oce_folioorden).then(function u(t){var n;e.rutaDocumento=t.data;var o="";o="application/pdf";var s="http://192.168.20.9:3700",u=s,l="Subir Documentos",c=r.user,i=r.pass,d=a.oce_folioorden,p="1";if("0"==t.data)n="http://192.168.20.9/GA_Centralizacion/CuentasXPagar/TempPdf/OrdenCompra/Orden_AU-AUA-VIG-UN-PS-26.pdf";else var n="http://192.168.20.9/GA_Centralizacion/CuentasXPagar/TempPdf/OrdenCompra/Orden_"+a.oce_folioorden+".pdf";var P='<iframe frameborder="1" height="600px" width="550px" src="http://192.168.20.9:8085/Login.aspx?user='+c+"&pass="+i+"&folio="+d+"&editar="+p+"&rutaPDF="+n+'" width="100%">Tu Navegador no soporta esta característica</iframe>';$.createModal({title:l,message:P,closeButton:!1,scrollable:!1})},function l(e){n.error("Ocurrio un problema al generar la factura")}))},function u(e){n.error("Ocurrio un problema al validar estatus : "+e.data)})},e.buscaDocumento=function(){o.saveDocumentos("CFE0316","AU-ZM-ZAR-OT-PS-1",4).success(O).error(v)};var E=function(a,r,t,o){e.rutaDocumento=a,n.success("Documento Obtenidos.")},O=function(a,r,t,o){e.rutaDocumento=a,n.success("Documento Guardados.")};e.toggleModal=function(){$("#viewNewEscalamiento").modal("show")},e.upSubeDocumento=function(){var a=new FormData;a.append("file",file),$http.post("post.php",a,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).success(function(a){e.imagen=a,e.img=!0}).error(function(e){})},e.uploadFile=function(){var e=new FormData;for(var a in scope.files)e.append("uploadedFile",scope.files[a]);var r=new XMLHttpRequest;r.upload.addEventListener("progress",l,!1),r.addEventListener("load",c,!1),r.addEventListener("error",i,!1),r.addEventListener("abort",d,!1),r.open("POST","/fileupload"),scope.progressVisible=!0,r.send(fd)},e.setFiles=function(a){e.$apply(function(r){console.log("files:",a.files),e.files=[];for(var t=0;t<a.files.length;t++)e.files.push(a.files[t]);e.progressVisible=!1})},e.getEmpleado=function(){u.getDoc(1,1,20).success(getDocSuccessCallback).error(v)},e.getDocSuccessCallback=function(a,t,o,s){if(null!=a)if(""!=a)e.documentoIni='<div><object id="ifDocument" data="'+a+'" type="application/pdf" width="100%"><p>Alternative text - include a link <a href="'+a+'">to the PDF!</a></p></object> </div>',u.getDoc(r.currentFolioFactura,r.currentEmployee,15).success(getDocRecepcionIniSuccessCallback).error(v),$("#btnSalir").hide();else{n.warning("Aun no se ha subido la Factura de este folio.");var l='<div class="noExiste"><b> El documento aun no esta disponible </b> </div>';$("#divDocumento").append(l),$("#divControles").hide()}else n.warning("No existe informacion para este folio.")},e.getDocRecepcionIniSuccessCallback=function(a,t,n,o){if(null!=a&&""!=a){var s=r.obtieneTypeAplication(a);e.documentoIni=e.documentoIni.replace("<div>",'<div class="izquierda">')+' <div class="derecha"><object id="ifDocument2" data="'+a+'" type="'+s+'" width="100%"><p>Error al cargar el documento. Intente de nuevo.</a></p></object></div>',1==e.consultaInicial&&$("#divControles").hide()}$("#divDocumento").append(e.documentoIni)}});